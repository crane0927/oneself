# Data Model: RESTful 宪法符合性审计

**Feature**: 002-restful-api-compliance  
**Phase**: 1 设计产物

本文档描述审计与整改所涉及的概念实体及其关系，不绑定具体实现技术。

---

## 1. 接口定义（Endpoint）

审计与整改的客体，表示对外暴露的一个 HTTP 端点。

| 属性 | 说明 |
|------|------|
| 模块/服务 | 所属模块（如 oneself-auth、oneself-system） |
| 类/方法 | Controller 类名与方法名（或 Feign 接口与方法） |
| URL 路径 | 完整路径（含 context-path、类级与方法级 path） |
| HTTP 方法 | GET / POST / PUT / DELETE / PATCH |
| 请求形态 | 查询参数、路径参数、Body 类型（若适用） |
| 响应形态 | 是否使用 Result&lt;T&gt; 包装、是否 JSON |
| 分页/排序 | 是否使用 page、size、sort；若否，当前方式 |
| 文档状态 | 是否在 API 文档中标注方法与状态码 |

**关系**: 一个接口可对应审计报告中的多行（按检查项）；一个接口整改后对应一条复检记录。

---

## 2. 原则 6 规则集（检查项）

宪法 115–133 条可操作化后的检查项，用于逐条判定接口是否符合。

| 检查项 ID | 描述 | 通过条件 | 不通过时建议 |
|-----------|------|----------|--------------|
| C1 | HTTP 方法标准 | 方法属于 GET、POST、PUT、DELETE、PATCH | 改用标准方法（如查询用 GET） |
| C2 | URL 名词化、无动词 | 路径为名词（复数）且不含 get/create/delete/list 等动词 | 改为资源路径（如 /users/{id}）+ 合适方法 |
| C3 | 响应 JSON + Result 包装 | 响应体为 JSON 且使用统一 Result&lt;T&gt; 包装 | 统一使用项目 Result 类型 |
| C4 | 分页与排序 | 分页用 page、size，排序用 sort（或文档化例外） | 改为 GET + page/size/sort 或记录例外 |
| C5 | 版本控制 | URL 含版本（如 /api/v1/）或文档说明策略 | 采用路径版本或文档说明 |
| C6 | 文档标注 | API 文档中标注该接口的 HTTP 方法与主要状态码 | 更新 API 文档 |

**状态**: 每项对每个接口可判定为：通过、不通过、例外（须附理由）。

---

## 3. 审计报告（Audit Report）

按接口与按规则维度的符合性结果，以及不符合时的原因与建议。

| 属性 | 说明 |
|------|------|
| 报告标识 | 生成时间、版本或流水号 |
| 审计范围 | 参与审计的模块/服务列表 |
| 接口列表 | 所有被审计的接口（见 接口定义） |
| 结果矩阵 | 每接口 × 每检查项：通过 / 不通过 / 例外 |
| 不符合详情 | 对每个“不通过”项：问题描述、建议改法（如“将 /getUser 改为 GET /users/{id}"） |
| 例外记录 | 对每个“例外”项：理由（如“认证接口业界惯例”） |
| 汇总 | 符合数/不符合数/例外数、通过率 |

**关系**: 报告引用多条接口定义与规则集；一次整改后可生成新报告做复检。

---

## 4. 状态与流程（概念）

- **接口**：当前状态为“未审计 / 已审计 / 已整改 / 已复检通过”。
- **审计报告**：一次审计对应一份报告；复检对应新报告，可与旧报告对比。
- **持续验证**：新接口或变更接口在合入前须经过规则集检查（人工清单或 CI），结果可为“通过 / 不通过 / 例外审批”。

无需持久化到数据库；报告可为 Markdown/JSON/Excel 等文件或 Wiki 页面。
